## 1) 목표 한 줄
- [ ] 런타임 코어 주입 0을 기준으로 `samples/brain-persona`와 `~/agents/bren`을 정합적으로 마이그레이션하고, 퍼스트파티 프롬프트 주입 extension 레퍼런스를 운영 가능한 형태로 일원화한다.

## 2) 문제/현상
- [ ] 현재 샘플/에이전트 마이그레이션 경로가 런타임 코어 주입 0과 정합되지 않아 실행 시 동작 편차와 추적 불가한 실행 경로가 발생한다.
- [ ] `samples/brain-persona`와 `~/agents/bren`의 구성/의존성이 상이해 재사용 가능한 배포 단위가 아니며, 확장 참조 규칙이 분산되어 관리 난도가 높다.
- [ ] 퍼스트파티 프롬프트 주입 extension에 대한 공식 레퍼런스가 정형화되지 않아 누락된 prompt injection 경로가 런타임 검증에 반영되지 않는다.

## 3) 목표 솔루션
- [ ] `Runtime Core Injection v0`을 기준으로 마이그레이션 단일 모델을 정의하고, 샘플·에이전트·확장 레퍼런스가 이를 따르도록 정렬한다.
- [ ] `samples/brain-persona`를 코어 주입 0 스키마/구성 규칙으로 전환하고, `~/agents/bren`의 구성요소(프롬프트, 워크플로, 툴 호출 정책)를 동일 기준으로 마이그레이션한다.
- [ ] 퍼스트파티 프롬프트 주입 extension 레퍼런스를 명세, 템플릿, 운영 가이드까지 한 번에 찾고 적용 가능한 구조로 통합한다.
- [ ] 모든 변경은 기존 동작을 대체하지 않고 점진 전환 가능한 단계로 설계해 실패 시 롤백 지점을 갖는다.

## 4) 비목표(하면 안 되는 것)
- [ ] 기존 런타임 제어 흐름을 전면 폐기하거나 v0와 무관한 방식으로 재설계하지 않는다.
- [ ] `samples/brain-persona` 또는 `~/agents/bren`의 기능적 의도를 임의 축소하지 않는다.
- [ ] 퍼스트파티 extension 레퍼런스를 비공식 패치로 임시 적용해 장기 운영을 정식 채택하지 않는다.

## 5) 비목표(범위 밖)
- [ ] 패키지 배포 정책 전면 변경, 다중 버전 호환성 정책 확장, 공개 릴리즈 전략 수립.
- [ ] UI/Studio 전용 기능 고도화(시각화/알림/대시보드 신규 개발).
- [ ] 신규 tool/connector/connector auth 스펙의 대규모 추가.

## 6) 확정 의사결정
- [ ] 코어 마이그레이션 기준점은 `런타임 코어 주입 0` 1개로 고정한다.
- [ ] 샘플/에이전트 마이그레이션 우선순위는 `samples/brain-persona` → `~/agents/bren` 순으로 확정한다.
- [ ] 퍼스트파티 프롬프트 주입은 extension 레퍼런스를 단일 진입점(문서+예시+검증 체크리스트)으로 통합해 운영 표준으로 채택한다.
- [ ] 성공 지표는 기능 동등성, 구성 정합성, 추적/재현 가능성, 되돌림 비용 최소화로 고정한다.

## 7) 의존관계 있는 상세 실행 계획(작업을 작은 단위로)
- [ ] 7.1 현황 정합성 수집 : 선행=[] 후행=[7.2,7.3] 완료기준: migration 대상 파일 목록(런타임 주입 포인트, brain-persona, bren, prompt extension 참조)이 누락 없이 문서화됨.
- [ ] 7.2 런타임 코어 주입 0 바운더리 정의 : 선행=[7.1] 후행=[7.4,7.6] 완료기준: 주입 진입점/라이프사이클/오류 핸들링/기본 값 정책이 단일 규약으로 정리됨.
- [ ] 7.3 퍼스트파티 프롬프트 확장 레퍼런스 수집 : 선행=[7.1] 후행=[7.5,7.7] 완료기준: 참조 경로, 필수 필드, 적용 우선순위, 예외 케이스가 체크 가능한 표준 스키마로 정리됨.
- [ ] 7.4 `samples/brain-persona` 마이그레이션 설계 : 선행=[7.2] 후행=[7.8] 완료기준: 기존 동작 대비 입력/출력 변경 없이 코어 주입 0 스펙 적합으로 변환 가능한 task list 확정.
- [ ] 7.5 `~/agents/bren` 마이그레이션 설계 : 선행=[7.2,7.3] 후행=[7.8] 완료기준: 브렌 에이전트의 상태 관리, tool 바인딩, prompt injection 경로가 주입 0 규약으로 매핑됨.
- [ ] 7.6 공통 마이그레이션 템플릿/샘플 구성 : 선행=[7.2,7.4,7.5] 후행=[7.8] 완료기준: 두 대상이 동일한 템플릿으로 재현 가능한 매뉴얼 Draft가 완성됨.
- [ ] 7.7 퍼스트파티 prompt injection 확장 레퍼런스 적용 전략 확정 : 선행=[7.3] 후행=[7.8] 완료기준: 레퍼런스 적용 우선순위, 검증 커맨드, 실패 시 fallback 규칙이 합의됨.
- [ ] 7.8 통합 반영 : 선행=[7.4,7.5,7.6,7.7] 후행=[8.x] 완료기준: 대상 샘플/에이전트가 동일 테스트 셋에서 코어 주입 0 경로로 실행되며 기본 동작 시나리오가 통과됨.
- [ ] 7.9 전환 체크리스트 및 운영 스위치 정비 : 선행=[7.8] 후행=[8.1-8.5] 완료기준: 단계별 전환 조건과 롤백 조건이 스텝 단위로 문서화됨.

## 8) 상세 검증 계획
### 8.1 단위 검증
- [ ] 단위 검증 : 대상 컴포넌트(마이그레이션 adapter, prompt injection hook, core injection 진입점)를 각각 최소 1개 이상 정상·에러 케이스로 검증하고, DoD 기준 로그/예외/trace id가 일치함을 확인한다.
### 8.2 통합 검증
- [ ] 통합 검증 : `samples/brain-persona`와 `~/agents/bren` 각각을 실행해 런타임 주입 0 경로에서 프롬프트 주입, tool 호출, 상태 전이의 기본 동작 동일성을 확인한다.
### 8.3 회귀 검증
- [ ] 회귀 검증 : 기존 샘플 집합에서 마이그레이션 전후 출력 포맷/상태 전이/에러 시나리오가 의도치 않게 변하지 않는지 비교한다.
### 8.4 운영 검증
- [ ] 운영 검증 : 마이그레이션 스위치 적용, 배포 단계별 모니터링 항목, 임계치, 장애 감시(재시작/타임아웃/프롬프트 누락) 점검표를 운영 문서로 배포한다.
### 8.5 실패 대응/롤백
- [ ] 실패 대응/롤백 : 실패 유형별 복구 절차(즉시 중단, 이전 상태 복원, 샘플/에이전트 개별 원복, 레퍼런스 참조 재적용)를 작성하고, 롤백 소요시간 및 책임자/승인 단계까지 포함해 실행 가능하게 정리한다.
