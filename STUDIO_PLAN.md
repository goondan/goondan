# 목표 개요 한 줄
`gdn studio`로 인스턴스 단위 실행 상태를 한 화면에서 실시간 관측(그래프/플로우)하고, 원인 추적 시간을 단축한다.

# 해결하고자 하는 문제(니즈)와 현 상태
- 니즈: 멀티 에이전트 런타임의 현재 활성 상태와 메시지 흐름을 텍스트 로그만으로 파악하기 어렵고, 장애 시 어떤 간선/스텝에서 문제가 났는지 즉시 확인하기 어렵다.
- 현 상태:
- `gdn instance`, `gdn logs`는 있으나 `gdn studio` 전용 명령이 없다.
- 좌측 인스턴스 목록 + 우측 시각화 기반 운영 화면이 없다.
- 그래프 모드(원형 노드/무방향 간선/실시간 활성/메시지 이동 애니메이션/간선 클릭 시 양방향 이력)와 플로우 다이어그램 모드(시간순 스크롤, agent step/tool/output 표시)가 정의/구현되어 있지 않다.
- 문서 동기화 기준(`docs/specs/*.md`, `docs/architecture.md`, `GUIDE.md`, `AGENTS`) 점검 절차가 이번 작업 기준으로 명시되어야 한다.

# 니즈를 해결하기 위한 솔루션(목표)
- `gdn studio` 명령을 추가해 Studio UI 진입점을 표준화한다.
- 기본 레이아웃을 좌측 `인스턴스 목록`, 우측 `시각화 뷰`로 고정한다.
- 그래프 모드:
- 원형 노드로 agent를 표현한다.
- 무방향 간선으로 agent 간 관계를 표현한다.
- 실시간 활성 상태를 노드/간선 하이라이트로 반영한다.
- 메시지 이동 애니메이션으로 이벤트 흐름을 보여준다.
- 간선 클릭 시 양방향 메시지 이력을 패널로 제공한다.
- 플로우 다이어그램 모드:
- 시간순 스크롤 타임라인으로 렌더링한다.
- agent step/tool/output을 동일 시퀀스에서 표시한다.
- 구현 및 점검 경로를 명확히 고정한다:
- `packages/cli`
- `packages/runtime`
- `docs/specs/*.md`
- `docs/architecture.md`
- `GUIDE.md`
- `AGENTS`

# 비목표 - 하면 안되는 것
- Studio에서 런타임 상태 변경(삭제/재시작/설정 변경)을 직접 수행하지 않는다.
- 기존 메시지 저장 계약(`messages/base.jsonl`, `messages/events.jsonl`)을 깨는 변경을 하지 않는다.
- 이번 범위에서 권한/멀티유저/원격 협업 기능을 함께 넣지 않는다.

# 비목표 - 앞으로 할 수도 있지만 범위 밖인 것
- 장기 보관 데이터 기반 타임트래블 리플레이.
- 웹 기반 원격 Studio(브라우저 대시보드).
- Studio에서 시각 편집 후 런타임 구성 자동 반영.

# 확정된 주요 의사결정 사항
- Studio 진입은 `gdn studio` 단일 커맨드로 제공한다.
- Studio 데이터 소스는 `packages/runtime`의 읽기 전용 projection으로 제공한다.
- 1차 모드는 `그래프 모드`와 `플로우 다이어그램 모드` 두 가지로 제한한다.
- 간선 클릭 히스토리는 양방향 통신을 단일 뷰에서 합쳐 시간순으로 제공한다.
- 문서 반영은 `docs/specs/*.md` 우선, 이후 `docs/architecture.md`/`GUIDE.md` 순으로 동기화한다.
- 작업 마감 시 루트/경로상의 `AGENTS` 최신성 점검을 완료 조건에 포함한다.

# 상세 실행 계획
1. CLI 진입점 추가 (`packages/cli`)
- `gdn studio` 서브커맨드 파서/라우터 추가.
- instance 선택 상태, 모드 토글 상태, 간선 선택 상태를 관리하는 화면 상태머신 구현.

2. 런타임 projection 확장 (`packages/runtime`)
- 인스턴스 목록 공급 API, 그래프 노드/간선 상태 projection, 간선 양방향 히스토리 projection 추가.
- 플로우 다이어그램용 step/tool/output 시간순 이벤트 projection 추가.

3. 그래프 모드 UI 구현 (`packages/cli`)
- 원형 노드/무방향 간선 렌더링.
- 실시간 활성 하이라이트 + 메시지 이동 애니메이션.
- 간선 클릭 시 양방향 이력 패널 연동.

4. 플로우 다이어그램 모드 UI 구현 (`packages/cli`)
- 시간순 스크롤 타임라인.
- agent step/tool/output 블록 렌더링.
- 그래프 모드와 선택 인스턴스/시간축 컨텍스트 동기화.

5. 문서 동기화 점검 및 반영
- `docs/specs/*.md`: CLI 계약, runtime projection 계약, 이벤트 표기 규칙 반영 여부 점검/수정.
- `docs/architecture.md`: Studio 위치/데이터 흐름/관측 모델 반영 여부 점검/수정.
- `GUIDE.md`: `gdn studio` 사용 절차, 모드 사용법, 운영 팁 반영 여부 점검/수정.
- `AGENTS`: 변경 경로 기준 최신성 점검 및 필요 시 갱신.

# 상세 검증 계획
1. 기능 검증
- `gdn studio` 실행 시 좌측 인스턴스 목록이 로드되고 전환이 정상 동작하는지 확인.
- 그래프 모드에서 원형 노드/무방향 간선/실시간 활성/메시지 이동 애니메이션이 이벤트와 동기화되는지 확인.
- 간선 클릭 시 양방향 이력이 시간순으로 누락 없이 표시되는지 확인.
- 플로우 다이어그램 모드에서 시간순 스크롤과 agent step/tool/output 표시가 정확한지 확인.

2. 테스트 검증
- `packages/runtime`: projection 단위 테스트(정렬, 중복 제거, burst 이벤트, 종료 이벤트).
- `packages/cli`: studio 명령 파서 테스트, 상태 전이 테스트(인스턴스 선택/모드 전환/간선 선택).
- 통합 테스트: 샘플 런타임 이벤트를 주입해 그래프/플로우 출력 일관성 검증.

3. 문서/규칙 검증
- 구현 변경사항이 `docs/specs/*.md`, `docs/architecture.md`, `GUIDE.md`와 충돌 없는지 최종 대조.
- 루트 및 변경 경로 `AGENTS` 최신성 점검 결과를 작업 종료 체크에 기록.
